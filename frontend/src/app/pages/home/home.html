<!-- CONTENEDOR PRINCIPAL: M√°ximo 1200px de ancho para centrar el contenido -->
<div class="catalogo-container">

    <!-- T√çTULO Y ACCI√ìN PRINCIPAL -->
    <div class="header-bar">
        <h1 class="titulo">
            üìö Cat√°logo de Libros
        </h1>

        <!-- Bot√≥n Registrar (solo Admin/Bibliotecario) -->
        <a *ngIf="currentRole === 'bibliotecario' || currentRole === 'admin'"
           [routerLink]="['/crear-libro']"
           class="btn-crear">
            + Registrar Nuevo Libro
        </a>
    </div>

    <!-- BARRA DE B√öSQUEDA -->
    <div class="busqueda-contenedor">
        <input 
            type="text"
            [(ngModel)]="searchQuery"
            name="searchQuery"
            placeholder="Buscar por T√≠tulo, Autor o ISBN..."
            class="input-busqueda"
            (keyup.enter)="buscarLibros()"
        >

        <button class="btn-buscar" (click)="buscarLibros()" [disabled]="isLoading">
            üîç Buscar
        </button>
    </div>

    <!-- Contador de Libros -->
    <p class="contador-libros">
        Mostrando <strong>{{ totalLibros }}</strong> libro{{ totalLibros === 1 ? '' : 's' }}.
    </p>

    <!-- ‚≠ê Mensaje de Error (si existe) -->
    <div *ngIf="errorMessage" class="mensaje-estado mensaje-error">
        {{ errorMessage }}
    </div>

    <!-- ‚≠ê Indicador de Carga -->
    <div *ngIf="isLoading" class="loading-indicator">
        <div style="border: 4px solid rgba(0, 0, 0, 0.1); border-top: 4px solid #0d4f84; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; margin: 0 auto 10px;"></div>
        <p style="color: #0d4f84; font-weight: 600;">Cargando...</p>
        <style>@keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }</style>
    </div>
    
    <!-- GRID DE LIBROS -->
    <div *ngIf="!isLoading" class="libros-grid">

        <div *ngFor="let libro of libros" class="tarjeta-libro">
            
            <!-- Imagen -->
            <div class="img-contenedor">
                <img 
                    [src]="libro.imagen_url || ''"
                    alt="Portada de {{ libro.titulo }}"
                    class="libro-img"
                    (error)="onImageError($event)"
                >
            </div>

            <!-- Informaci√≥n -->
            <div class="libro-detalles">
                <h3 class="libro-titulo">{{ libro.titulo }}</h3>

                <p class="detalle"><strong>Autor:</strong> {{ libro.autor_nombre }}</p>
                <p class="detalle"><strong>Categor√≠a:</strong> {{ libro.categoria_nombre }}</p>
                <p class="detalle"><strong>ISBN:</strong> {{ libro.isbn }}</p>

                <p class="disponibilidad">
                    Disponibles:
                    <span 
                        [class.disponible]="libro.copias_disponibles > 0"
                        [class.no-disponible]="libro.copias_disponibles === 0">
                        {{ libro.copias_disponibles }}
                    </span>
                </p>

                <!-- Acciones para lectores -->
                <!-- TODO: Se necesita implementar la funci√≥n solicitarPrestamo en TS -->
                <button 
                    
                    class="btn-prestar">
                    Solicitar Pr√©stamo
                </button>

                <span 
                    *ngIf="currentRole === 'lector' && libro.copias_disponibles === 0"
                    class="no-disponible-box">
                    No Disponible
                </span>

                <!-- Acciones Admin/Bibliotecario -->
                <div *ngIf="currentRole === 'bibliotecario' || currentRole === 'admin'" class="acciones-admin">
                    <a [routerLink]="['/libro/form', libro.id]" class="btn-editar">
                        Editar
                    </a>

                    <button (click)="eliminarLibro(libro.id)" class="btn-eliminar">
                        Eliminar
                    </button>
                </div>
            </div>
        </div>

    </div>

    <!-- Si no hay resultados y no est√° cargando -->
    <div *ngIf="!isLoading && libros.length === 0" class="sin-libros">
        No se encontraron libros que coincidan con la b√∫squeda.
    </div>

</div>
